name: Build Windows CC Package V2

on: [workflow_dispatch]

jobs:
  build:
    runs-on: windows-latest
    
    # 关键修改：强制使用 Bash，避免 PowerShell 语法坑
    defaults:
      run:
        shell: bash

    steps:
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '20'

    - name: Initialize Project
      run: |
        npm init -y
        # 设置淘宝源，防止网络超时导致安装失败
        npm config set registry https://registry.npmmirror.com

    - name: Install Claude Code (Windows)
      run: |
        echo "开始安装..."
        # 增加 --no-optional 避免安装不必要的底层编译工具
        # 增加 --verbose 以便出错时能看到具体原因
        npm install @anthropic-ai/claude-code --no-optional --verbose

    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      # 无论上一步是否完全成功，都尝试打包结果方便检查
      if: always() 
      with:
        name: node_modules_windows
        path: node_modules/
        retention-days: 1
